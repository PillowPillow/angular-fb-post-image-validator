// angular-fb-post-image-validator
// version: 0.1.0
// author: Gaignoux Nicolas
// generated: Thu Apr 02 2015 11:23:31 GMT+0200 (Paris, Madrid (heure d’été))
// Autogenerated, do not edit. All changes will be undone.
!function(a,b,angular){"use strict";angular.module("fbPostImageValidator",[]),angular.module("fbPostImageValidator").run(["$templateCache",function(a){a.put("../lib/templates/fbImgValidator.jade",'<section class="img-container">\n  <canvas></canvas>\n</section>\n<section ng-style="containerStyle" class="case-container">\n  <article ng-style="rowStyle" ng-repeat="(x,col) in grid track by $index" class="case-col">\n    <article ng-style="caseStyle" ng-class="{valid:value===1,invalid:value===0}" ng-repeat="(y,value) in col track by $index" ng-click="toggleCase(x,y)" class="case-row"></article>\n  </article>\n</section>')}]),angular.module("fbPostImageValidator").constant("fbPostImageValidator.constants.imgCaseStates",{VALID:1,INVALID:0,UNDEFINED:-1});var c=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")};angular.module("fbPostImageValidator").directive("fbImgValidator",["fbPostImageValidator.services.grid","fbPostImageValidator.services.fileReader","fbPostImageValidator.constants.imgCaseStates","$q",function(a,b,d,e){return{scope:{value:"=ngModel",col:"@?col",row:"@?row",maxText:"=?maxText",width:"=?imgWidth",height:"=?imgHeight",name:"@name"},require:"ngModel",restrict:"AE",templateUrl:"../lib/templates/fbImgValidator.jade",link:function(f,g,h,i){function j(a,b){var c=""+a+":"+b,e=r.indexOf(c);~e&&r.splice(e,1),f.grid[a][b]!==d.UNDEFINED?f.grid[a][b]=d.UNDEFINED:r.push(c),k(),i.$setValidity("tooManyText",!l())}function k(){for(var a=m(),b=0;b<r.length;b++){var e=r[b].split(":"),g=c(e,2),h=g[0],i=g[1];f.grid[h][i]=a>b?d.VALID:d.INVALID}}function l(){var a=void 0===arguments[0]?!1:arguments[0];return r.length+(a?1:0)>m()}function m(){return f.maxText/100*f.row*f.col}function n(a){var c;if(a instanceof Object)c=b(a).loadImage();else{var d=new Image,f=e.defer();d.onload=function(){f.resolve(this)},d.src=a,c=f.promise}c.then(function(a){return o(a)})}function o(a){var b=a.height,c=a.width;f.width&&(c=parseInt(f.width,10),f.height||(b=f.width/a.width*a.height)),f.height&&(b=parseInt(f.height,10),f.width||(c=f.height/a.height*a.width)),p(c,b),q.setAttribute("width",c),q.setAttribute("height",b),q.getContext("2d").drawImage(a,0,0,c,b)}function p(a,b){f.caseStyle.width=""+a/f.col+"px",f.caseStyle.height=""+b/f.row+"px",f.rowStyle.height=""+b/f.row+"px",f.rowStyle.width=""+a+"px",f.containerStyle.width=""+a+"px",f.containerStyle.height=""+b+"px"}f.maxText=f.maxText?parseInt(f.maxText,10):20,f.col=f.col?parseInt(f.col,10):1,f.row=f.row?parseInt(f.row,10):1,f.grid=[],f.caseStyle={},f.rowStyle={},f.containerStyle={},f.toggleCase=j,i.$name=f.name;var q=g[0].querySelector("canvas"),r=[];f.$watch("col+row",function(){return f.grid=a.generate(f.col,f.row)}),f.$watch("value",function(){return n(f.value)})}}}]),angular.module("fbPostImageValidator").service("fbPostImageValidator.services.fileReader",["$window","$q",function(a,b){function c(){return{support:!(!a.FileReader||!a.CanvasRenderingContext2D),isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}}}var d=this;return this.extractInfos=c,function(a){var c=d.extractInfos(a);if(!c.isImage(a))throw Error("Not an image");return d.loadImage=function(){function c(){e.resolve(this)}var d=new FileReader,e=b.defer();return d.readAsDataURL(a),d.onload=function(a){var b=new Image;b.onload=c,b.src=a.target.result},e.promise},d}}]),angular.module("fbPostImageValidator").service("fbPostImageValidator.services.grid",["fbPostImageValidator.constants.imgCaseStates",function(a){function b(){var b=void 0===arguments[0]?1:arguments[0],c=void 0===arguments[1]?1:arguments[1],d=[];b=parseInt(b,10),c=parseInt(c,10);for(var e=0;b>e;e++){d.push([]);for(var f=0;c>f;f++)d[e].push(a.UNDEFINED)}return d}function c(){for(var b=void 0===arguments[0]?[]:arguments[0],c=0,d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++)"undefined"!=typeof b[d][e]&&b[d][e]!==a.UNDEFINED&&c++;return c}this.generate=b,this.getAmountOfSelectedCase=c}])}(window,window.document,window.angular);